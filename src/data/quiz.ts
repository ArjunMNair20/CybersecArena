import { processQuizQuestions } from '../utils/shuffleOptions';
import { normalizeQuizChoices } from '../utils/normalizeOptionLengths';

export type QuizQuestion = {
  id: string;
  difficulty: 'easy' | 'medium' | 'hard';
  prompt: string;
  choices: string[];
  answer: number;
  explain: string;
};

const QUIZ_QUESTIONS_BASE: QuizQuestion[] = [
  // -------------------- BEGINNER (EASY) – 25 QUESTIONS --------------------
  {
    id: 'q-easy-1',
    difficulty: 'easy',
    prompt: 'Which is a strong authentication control?',
    choices: ['MFA', 'Shared passwords', 'Plaintext storage', 'Security through obscurity'],
    answer: 0,
    explain: 'MFA adds a second factor, greatly reducing account takeover risk.',
  },
  {
    id: 'q-easy-2',
    difficulty: 'easy',
    prompt: 'What helps prevent SQL injection?',
    choices: ['Parameterized queries', 'String concatenation', 'Dynamic SQL with user input', 'Disabling errors'],
    answer: 0,
    explain: 'Parameterized queries prevent untrusted input from changing query structure.',
  },
  {
    id: 'q-easy-3',
    difficulty: 'easy',
    prompt: 'What is the safest way to handle suspicious email attachments?',
    choices: ['Open them to see what they are', 'Forward them to friends', 'Delete or report them', 'Reply asking if it is safe'],
    answer: 2,
    explain: 'Deleting or reporting suspicious attachments prevents malware from executing.',
  },
  {
    id: 'q-easy-4',
    difficulty: 'easy',
    prompt: 'Which password is generally the strongest?',
    choices: ['P@ssw0rd', '12345678', 'MyDogIs3YearsOld!', 'qwerty'],
    answer: 2,
    explain: 'A long passphrase with mixed characters is stronger than short, common passwords.',
  },
  {
    id: 'q-easy-5',
    difficulty: 'easy',
    prompt: 'Which of these is a form of social engineering?',
    choices: ['Brute-force attack', 'Phishing email', 'SQL injection', 'DDoS attack'],
    answer: 1,
    explain: 'Phishing manipulates people into revealing information or clicking malicious links.',
  },
  {
    id: 'q-easy-6',
    difficulty: 'easy',
    prompt: 'Why should you lock your screen when leaving your desk?',
    choices: ['To save battery', 'To prevent shoulder surfing', 'To prevent unauthorized access', 'To improve Wi-Fi'],
    answer: 2,
    explain: 'Locking your screen stops others from using your account while you are away.',
  },
  {
    id: 'q-easy-7',
    difficulty: 'easy',
    prompt: 'What does HTTPS add on top of HTTP?',
    choices: ['More ads', 'Encryption and integrity', 'Faster loading', 'Offline support'],
    answer: 1,
    explain: 'HTTPS encrypts traffic and helps ensure it is not modified in transit.',
  },
  {
    id: 'q-easy-8',
    difficulty: 'easy',
    prompt: 'Which is the best place to store your passwords?',
    choices: ['Browser notes', 'Sticky notes on monitor', 'Password manager', 'Plain text file on desktop'],
    answer: 2,
    explain: 'Password managers securely store and encrypt your passwords.',
  },
  {
    id: 'q-easy-9',
    difficulty: 'easy',
    prompt: 'You receive an email asking for your login details urgently. What should you do?',
    choices: ['Reply with your credentials', 'Ignore all emails', 'Verify via official channel first', 'Click all links to see what happens'],
    answer: 2,
    explain: 'Always verify using known, trusted channels instead of responding to unsolicited requests.',
  },
  {
    id: 'q-easy-10',
    difficulty: 'easy',
    prompt: 'Which of the following is an example of malware?',
    choices: ['Firewall', 'Antivirus', 'Ransomware', 'Password manager'],
    answer: 2,
    explain: 'Ransomware is malicious software that encrypts data and demands payment.',
  },
  {
    id: 'q-easy-11',
    difficulty: 'easy',
    prompt: 'Why should you install software updates?',
    choices: ['To change the logo', 'They often include security patches', 'They slow down your device', 'They remove all features'],
    answer: 1,
    explain: 'Updates frequently patch security vulnerabilities exploited by attackers.',
  },
  {
    id: 'q-easy-12',
    difficulty: 'easy',
    prompt: 'What is the main purpose of a firewall?',
    choices: ['To design websites', 'To block or allow network traffic', 'To store passwords', 'To speed up the CPU'],
    answer: 1,
    explain: 'Firewalls filter network traffic based on security rules.',
  },
  {
    id: 'q-easy-13',
    difficulty: 'easy',
    prompt: 'Which of these Wi-Fi networks is generally safest to use?',
    choices: ['Open public Wi-Fi', 'WPA2/WPA3 password-protected', 'Unknown hidden network', 'Ad-hoc peer-to-peer network'],
    answer: 1,
    explain: 'WPA2/WPA3-protected networks encrypt wireless traffic with a shared key.',
  },
  {
    id: 'q-easy-14',
    difficulty: 'easy',
    prompt: 'What is phishing?',
    choices: [
      'Scanning ports on a server',
      'Sending fake messages to trick users',
      'Encrypting files for backup',
      'Resetting a password',
    ],
    answer: 1,
    explain: 'Phishing uses deceptive messages to trick users into revealing sensitive information.',
  },
  {
    id: 'q-easy-15',
    difficulty: 'easy',
    prompt: 'Which is a good sign that a website might be fake or malicious?',
    choices: ['Typos and strange URLs', 'Valid certificate', 'Secure padlock icon', 'Professional design'],
    answer: 0,
    explain: 'Typos and odd domain names can be red flags for fake or phishing sites.',
  },
  {
    id: 'q-easy-16',
    difficulty: 'easy',
    prompt: 'Why should you avoid reusing the same password everywhere?',
    choices: [
      'It is hard to type',
      'If one site is breached, all your accounts are at risk',
      'Websites forbid it',
      'It makes logging in slower',
    ],
    answer: 1,
    explain: 'Password reuse allows a single breach to compromise many of your accounts.',
  },
  {
    id: 'q-easy-17',
    difficulty: 'easy',
    prompt: 'Which of the following is PII (Personally Identifiable Information)?',
    choices: ['Favorite color', 'IP address alone', 'Home address and full name', 'Operating system'],
    answer: 2,
    explain: 'Name and home address together can uniquely identify an individual.',
  },
  {
    id: 'q-easy-18',
    difficulty: 'easy',
    prompt: 'What should you do if you suspect your account was compromised?',
    choices: ['Do nothing', 'Post about it on social media only', 'Change password and enable MFA', 'Uninstall your browser'],
    answer: 2,
    explain: 'Resetting credentials and enabling MFA help regain control and secure the account.',
  },
  {
    id: 'q-easy-19',
    difficulty: 'easy',
    prompt: 'Why is using public USB charging stations risky?',
    choices: ['They are slow', 'They can be used for juice jacking (data theft)', 'They cost money', 'They overcharge the battery'],
    answer: 1,
    explain: 'Compromised charging ports can exfiltrate data or install malware via USB.',
  },
  {
    id: 'q-easy-20',
    difficulty: 'easy',
    prompt: 'What is the safest way to install mobile apps?',
    choices: ['From official app stores', 'From random websites', 'From email attachments', 'From USB drives'],
    answer: 0,
    explain: 'Official app stores perform basic security checks and reduce malware risk.',
  },
  {
    id: 'q-easy-21',
    difficulty: 'easy',
    prompt: 'What does MFA typically require in addition to a password?',
    choices: ['Username', 'Captcha only', 'Another factor like a code or biometric', 'Browser history'],
    answer: 2,
    explain: 'MFA adds something you have or are, such as an OTP or fingerprint, to something you know.',
  },
  {
    id: 'q-easy-22',
    difficulty: 'easy',
    prompt: 'Why is sharing login credentials with coworkers a bad idea?',
    choices: [
      'It is against basic security policy',
      'It makes logins slower',
      'Systems do not allow it',
      'It reduces phishing risk',
    ],
    answer: 0,
    explain: 'Shared credentials break accountability and increase risk if leaked or misused.',
  },
  {
    id: 'q-easy-23',
    difficulty: 'easy',
    prompt: 'Which of these is a sign of a potentially malicious mobile app?',
    choices: ['Many positive reviews', 'Excessive permissions for simple tasks', 'Frequent updates', 'Clear privacy policy'],
    answer: 1,
    explain: 'Apps requesting unnecessary sensitive permissions may be malicious.',
  },
  {
    id: 'q-easy-24',
    difficulty: 'easy',
    prompt: 'What should you do before clicking a link in an email?',
    choices: ['Click immediately', 'Hover to inspect the URL', 'Reply asking what it is', 'Forward to everyone'],
    answer: 1,
    explain: 'Hovering reveals the real destination so you can spot suspicious URLs.',
  },
  {
    id: 'q-easy-25',
    difficulty: 'easy',
    prompt: 'Which action best protects your data if your device is stolen?',
    choices: ['Using a screensaver', 'Full-disk encryption and strong PIN', 'Disabling Wi-Fi', 'Closing all apps'],
    answer: 1,
    explain: 'Full-disk encryption and a strong unlock method protect data even if the device is lost.',
  },
  {
    id: 'q-easy-26',
    difficulty: 'easy',
    prompt: 'What is a buffer overflow vulnerability?',
    choices: [
      'When a network buffer exceeds its maximum transfer rate',
      'When program writes more data to a buffer than it can hold, overwriting adjacent memory',
      'When a database has too many records',
      'When a graphics display runs out of video memory',
    ],
    answer: 1,
    explain: 'Buffer overflows occur when data exceeds buffer boundaries, potentially overwriting the return address or sensitive data and leading to code execution or crashes.',
  },
  {
    id: 'q-easy-27',
    difficulty: 'easy',
    prompt: 'What is the main purpose of a firewall in a computer network?',
    choices: [
      'To store backup files',
      'To monitor and control incoming and outgoing network traffic',
      'To increase internet speed',
      'To delete viruses automatically',
    ],
    answer: 1,
    explain: 'A firewall monitors and controls network traffic based on security rules, allowing or blocking connections to protect against unauthorized access and network threats.',
  },
  {
    id: 'q-easy-28',
    difficulty: 'easy',
    prompt: 'What does encryption do to data?',
    choices: [
      'Deletes sensitive information',
      'Converts data into unreadable form using a cipher and key',
      'Backs up files to the cloud',
      'Removes all data from a device',
    ],
    answer: 1,
    explain: 'Encryption transforms readable data into ciphertext using an algorithm and key. Only someone with the correct decryption key can convert it back to readable form.',
  },

  // -------------------- INTERMEDIATE (MEDIUM) – 25 QUESTIONS --------------------
  {
    id: 'q-med-1',
    difficulty: 'medium',
    prompt: 'To mitigate XSS in rich text, you should:',
    choices: ['Sanitize HTML', 'Use eval()', 'Rely on CSP alone', 'Trust user input'],
    answer: 0,
    explain: 'Sanitize untrusted HTML and prefer safe rendering patterns; CSP complements.',
  },
  {
    id: 'q-med-2',
    difficulty: 'medium',
    prompt: 'Which network control detects intrusions by pattern matching?',
    choices: ['IDS', 'WAF', 'NAT', 'CDN'],
    answer: 0,
    explain: 'IDS inspects traffic for known attack signatures and anomalies.',
  },
  {
    id: 'q-med-3',
    difficulty: 'medium',
    prompt: 'Which header helps mitigate clickjacking?',
    choices: ['X-Frame-Options', 'Content-Type', 'ETag', 'Accept-Language'],
    answer: 0,
    explain: 'X-Frame-Options or CSP frame-ancestors restrict which sites can frame your content.',
  },
  {
    id: 'q-med-4',
    difficulty: 'medium',
    prompt: 'What is the main difference between encoding and encryption?',
    choices: [
      'Encoding is reversible without a key, encryption requires a key',
      'Encoding uses keys, encryption does not',
      'They are the same',
      'Both are irreversible',
    ],
    answer: 0,
    explain: 'Encoding is for data representation; encryption uses keys to protect confidentiality.',
  },
  {
    id: 'q-med-5',
    difficulty: 'medium',
    prompt: 'In the CIA triad, what does “A” stand for?',
    choices: ['Authentication', 'Authorization', 'Availability', 'Accounting'],
    answer: 2,
    explain: 'CIA stands for Confidentiality, Integrity, and Availability.',
  },
  {
    id: 'q-med-6',
    difficulty: 'medium',
    prompt: 'Which practice best protects against password database leaks?',
    choices: ['Storing passwords in plain text', 'Hashing with a slow, salted algorithm', 'Using reversible encryption', 'Logging passwords'],
    answer: 1,
    explain: 'Slow, salted hash functions (e.g., bcrypt, Argon2) reduce the impact of credential leaks.',
  },
  {
    id: 'q-med-7',
    difficulty: 'medium',
    prompt: 'What is the main risk of using hard-coded API keys in source code?',
    choices: [
      'Compilation errors',
      'Keys can be extracted and abused',
      'Slower performance',
      'Better debugging',
    ],
    answer: 1,
    explain: 'Hard-coded secrets are easy to leak via repos or binaries and can be misused by attackers.',
  },
  {
    id: 'q-med-8',
    difficulty: 'medium',
    prompt: 'Which of these best describes least privilege?',
    choices: [
      'Users get all permissions by default',
      'Grant only the access strictly required to perform a task',
      'Admins share one high-privilege account',
      'Everyone uses root for convenience',
    ],
    answer: 1,
    explain: 'Least privilege limits damage by granting only necessary permissions.',
  },
  {
    id: 'q-med-9',
    difficulty: 'medium',
    prompt: 'A CSRF (Cross-Site Request Forgery) attack relies on:',
    choices: [
      'User clicking a link in a phishing email',
      'User’s browser automatically sending credentials to a trusted site',
      'Weak password policy',
      'Exploiting buffer overflows',
    ],
    answer: 1,
    explain: 'CSRF abuses the browser’s authenticated session with a trusted site to send unwanted requests.',
  },
  {
    id: 'q-med-10',
    difficulty: 'medium',
    prompt: 'Which is an effective mitigation for CSRF in web apps?',
    choices: ['Parameterized queries', 'CSRF tokens and SameSite cookies', 'Reflected input', 'Base64 encoding'],
    answer: 1,
    explain: 'Anti-CSRF tokens and SameSite cookies help ensure requests are intentional.',
  },
  {
    id: 'q-med-11',
    difficulty: 'medium',
    prompt: 'What is a common sign of a command injection vulnerability?',
    choices: [
      'User input concatenated into shell commands',
      'Use of prepared statements',
      'Lack of logging',
      'Strong input validation',
    ],
    answer: 0,
    explain: 'Building shell commands via string concatenation with user input is a red flag.',
  },
  {
    id: 'q-med-12',
    difficulty: 'medium',
    prompt: 'Why are default credentials on network devices dangerous?',
    choices: [
      'They are easy to remember',
      'They are widely known and can be brute-forced',
      'They disable logging',
      'They improve performance',
    ],
    answer: 1,
    explain: 'Default credentials are published and often targeted by automated scans.',
  },
  {
    id: 'q-med-13',
    difficulty: 'medium',
    prompt: 'Which log entry is most suspicious from a security perspective?',
    choices: [
      'Single failed login',
      'Many rapid login attempts from different IPs',
      'User viewing profile page',
      'Scheduled backup completed',
    ],
    answer: 1,
    explain: 'Burst login attempts from multiple IPs can indicate credential stuffing or brute-force attacks.',
  },
  {
    id: 'q-med-14',
    difficulty: 'medium',
    prompt: 'Why is input validation alone not enough to prevent SQL injection?',
    choices: [
      'Databases ignore validation',
      'Attackers only use numeric input',
      'Strong validation can still miss crafted payloads; parameterization is safer',
      'Validation slows the DB too much',
    ],
    answer: 2,
    explain: 'Parameterization separates data from query logic even if validation fails.',
  },
  {
    id: 'q-med-15',
    difficulty: 'medium',
    prompt: 'Which vulnerability category does OWASP A01:2021 primarily refer to?',
    choices: ['Cryptographic Failures', 'Broken Access Control', 'Security Logging and Monitoring Failures', 'Injection'],
    answer: 1,
    explain: 'OWASP A01:2021 highlights Broken Access Control as the top risk.',
  },
  {
    id: 'q-med-16',
    difficulty: 'medium',
    prompt: 'Which mechanism best protects API endpoints from overuse?',
    choices: ['Rate limiting and quotas', 'Longer URLs', 'More detailed error messages', 'Storing secrets in code'],
    answer: 0,
    explain: 'Rate limiting and quotas reduce abuse like brute-force or denial-of-service via APIs.',
  },
  {
    id: 'q-med-17',
    difficulty: 'medium',
    prompt: 'Why should error messages avoid exposing stack traces in production?',
    choices: [
      'They slow down the server',
      'They reveal sensitive implementation details to attackers',
      'They hide bugs',
      'They break logging',
    ],
    answer: 1,
    explain: 'Detailed errors can leak file paths, technologies, and internal logic useful to attackers.',
  },
  {
    id: 'q-med-18',
    difficulty: 'medium',
    prompt: 'What is a common sign of ransomware infection?',
    choices: [
      'Device runs cooler',
      'Files suddenly become encrypted with ransom notes',
      'Browser opens faster',
      'Wi-Fi disconnects once',
    ],
    answer: 1,
    explain: 'Ransomware encrypts data and displays a ransom demand to restore access.',
  },
  {
    id: 'q-med-19',
    difficulty: 'medium',
    prompt: 'What does “defense in depth” mean in security?',
    choices: [
      'Relying only on a firewall',
      'Multiple layers of controls to protect assets',
      'Encrypting only backups',
      'Using one strong password',
    ],
    answer: 1,
    explain: 'Defense in depth uses layered controls so that if one fails, others still provide protection.',
  },
  {
    id: 'q-med-20',
    difficulty: 'medium',
    prompt: 'Why is logging important for incident response?',
    choices: [
      'It slows attackers',
      'It provides evidence and timelines of activity',
      'It prevents all attacks',
      'It replaces backups',
    ],
    answer: 1,
    explain: 'Logs help analysts reconstruct events and identify attack vectors.',
  },
  {
    id: 'q-med-21',
    difficulty: 'medium',
    prompt: 'Which of the following is an example of privilege escalation?',
    choices: [
      'User logs out',
      'Guest user gains admin rights',
      'User changes their own password',
      'App restarts',
    ],
    answer: 1,
    explain: 'Privilege escalation occurs when a user gains higher privileges than intended.',
  },
  {
    id: 'q-med-22',
    difficulty: 'medium',
    prompt: 'Which technique helps protect stored passwords on the client side?',
    choices: ['LocalStorage plain text', 'Secure, httpOnly cookies with server-side validation', 'URL parameters', 'Commenting them in HTML'],
    answer: 1,
    explain: 'HttpOnly cookies are not accessible to JavaScript, reducing exposure to XSS.',
  },
  {
    id: 'q-med-23',
    difficulty: 'medium',
    prompt: 'What is a common goal of reconnaissance in the cyber kill chain?',
    choices: [
      'Encrypting data',
      'Gathering information about targets and systems',
      'Erasing logs',
      'Installing rootkits',
    ],
    answer: 1,
    explain: 'Reconnaissance collects data about targets to plan further attacks.',
  },
  {
    id: 'q-med-24',
    difficulty: 'medium',
    prompt: 'Why is storing JWTs in localStorage risky?',
    choices: [
      'They expire too fast',
      'They cannot be decoded',
      'They are accessible to JavaScript and exposed to XSS',
      'They break HTTPS',
    ],
    answer: 2,
    explain: 'XSS can steal tokens stored in localStorage, compromising accounts.',
  },
  {
    id: 'q-med-25',
    difficulty: 'medium',
    prompt: 'What is a secure practice for handling secrets in CI/CD pipelines?',
    choices: [
      'Committing them to the repo',
      'Using dedicated secret management / encrypted variables',
      'Hard-coding into Dockerfiles',
      'Echoing them in logs for debugging',
    ],
    answer: 1,
    explain: 'Centralized secret management and encrypted variables limit exposure and rotation risk.',
  },

  // -------------------- EXPERT (HARD) – 25 QUESTIONS --------------------
  {
    id: 'q-hard-1',
    difficulty: 'hard',
    prompt: 'Which property ensures a message cannot be altered undetected?',
    choices: ['Confidentiality', 'Integrity', 'Availability', 'Non-repudiation'],
    answer: 1,
    explain: 'Integrity means modifications are detectable (e.g., MAC/HMAC).',
  },
  {
    id: 'q-hard-2',
    difficulty: 'hard',
    prompt: 'A supply-chain attack most likely compromises:',
    choices: ['User passwords', 'Third-party dependency', 'TLS certificates only', 'Browser cache'],
    answer: 1,
    explain: 'Attackers compromise dependencies or build systems to spread malicious updates.',
  },
  {
    id: 'q-hard-3',
    difficulty: 'hard',
    prompt: 'Which cryptographic mode is generally recommended for authenticated encryption?',
    choices: ['AES-ECB', 'AES-GCM', 'DES-CBC', 'RC4'],
    answer: 1,
    explain: 'AES-GCM provides confidentiality and integrity via authenticated encryption.',
  },
  {
    id: 'q-hard-4',
    difficulty: 'hard',
    prompt: 'Why is AES-ECB mode insecure for most data?',
    choices: [
      'Keys are too short',
      'It leaks patterns because identical plaintext blocks produce identical ciphertext blocks',
      'It is too slow',
      'It requires hardware acceleration',
    ],
    answer: 1,
    explain: 'ECB reveals patterns in structured data, undermining confidentiality.',
  },
  {
    id: 'q-hard-5',
    difficulty: 'hard',
    prompt: 'What is a common weakness of rolling your own cryptography?',
    choices: [
      'Better performance',
      'High risk of subtle implementation flaws',
      'Guaranteed FIPS compliance',
      'Automatic key rotation',
    ],
    answer: 1,
    explain: 'Custom crypto is notoriously hard to implement correctly; use vetted libraries instead.',
  },
  {
    id: 'q-hard-6',
    difficulty: 'hard',
    prompt: 'In OAuth 2.0, which flow is generally recommended for SPAs with a backend-for-frontend?',
    choices: ['Implicit Flow', 'Password Grant', 'Authorization Code with PKCE', 'Client Credentials only'],
    answer: 2,
    explain: 'Authorization Code with PKCE is designed to mitigate interception risks in public clients.',
  },
  {
    id: 'q-hard-7',
    difficulty: 'hard',
    prompt: 'What is a key reason to rotate cryptographic keys regularly?',
    choices: [
      'Improve performance',
      'Limit damage if a key is compromised',
      'Reduce certificate size',
      'Avoid TLS handshakes',
    ],
    answer: 1,
    explain: 'Key rotation limits the window of exposure and amount of data encrypted with a single key.',
  },
  {
    id: 'q-hard-8',
    difficulty: 'hard',
    prompt: 'Which attack abuses speculative execution in CPUs to leak secrets?',
    choices: ['Heartbleed', 'Spectre/Meltdown', 'Rowhammer', 'POODLE'],
    answer: 1,
    explain: 'Spectre and Meltdown exploit speculative execution and cache side channels to read sensitive data.',
  },
  {
    id: 'q-hard-9',
    difficulty: 'hard',
    prompt: 'Why is disabling certificate validation in HTTPS clients extremely dangerous?',
    choices: [
      'It slows performance',
      'It enables trivial man-in-the-middle attacks',
      'It breaks TLS handshakes',
      'It invalidates JWTs',
    ],
    answer: 1,
    explain: 'Without certificate validation, attackers can impersonate any server and intercept traffic.',
  },
  {
    id: 'q-hard-10',
    difficulty: 'hard',
    prompt: 'In access control, what is a common pitfall of relying only on client-side checks?',
    choices: [
      'They are too fast',
      'Attackers can bypass or modify them, so server-side checks are required',
      'They are strongly encrypted',
      'They cannot be tested',
    ],
    answer: 1,
    explain: 'Client-side checks can be altered; authoritative authorization must happen on the server.',
  },
  {
    id: 'q-hard-11',
    difficulty: 'hard',
    prompt: 'What is the main advantage of using hardware security modules (HSMs)?',
    choices: [
      'Cheaper than software',
      'Keys never leave secure hardware boundaries',
      'They replace TLS',
      'They hash passwords automatically',
    ],
    answer: 1,
    explain: 'HSMs protect cryptographic keys within tamper-resistant hardware.',
  },
  {
    id: 'q-hard-12',
    difficulty: 'hard',
    prompt: 'Which situation best illustrates an insecure direct object reference (IDOR)?',
    choices: [
      'User cannot reset password',
      'User changes URL from /order/1 to /order/2 and sees another user’s order',
      'Server uses HTTPS',
      'App logs out after inactivity',
    ],
    answer: 1,
    explain: 'IDOR occurs when object references are exposed without proper authorization checks.',
  },
  {
    id: 'q-hard-13',
    difficulty: 'hard',
    prompt: 'Why is storing password reset tokens in plain text a bad practice?',
    choices: [
      'Tokens expire too fast',
      'If the DB is leaked, attackers can reset any account',
      'They cannot be indexed',
      'They break logs',
    ],
    answer: 1,
    explain: 'Reset tokens act like passwords; they should be hashed and protected.',
  },
  {
    id: 'q-hard-14',
    difficulty: 'hard',
    prompt: 'Which approach best protects against SSRF (Server-Side Request Forgery)?',
    choices: [
      'Allow requests to all internal IP ranges',
      'Input validation only',
      'Deny internal address ranges and use allow-lists for outbound requests',
      'Longer URLs',
    ],
    answer: 2,
    explain: 'Blocking internal networks and using allow-lists reduces SSRF impact.',
  },
  {
    id: 'q-hard-15',
    difficulty: 'hard',
    prompt: 'Which technique can attackers use to bypass naive IP-based access controls?',
    choices: ['DNS over HTTPS', 'IP spoofing / proxying through allowed ranges', 'TLS pinning', 'HSTS'],
    answer: 1,
    explain: 'Attackers may proxy traffic through trusted networks or spoof IPs to bypass IP-based filters.',
  },
  {
    id: 'q-hard-16',
    difficulty: 'hard',
    prompt: 'What is “certificate pinning” primarily used for?',
    choices: [
      'Speeding up DNS',
      'Ensuring the client only trusts a specific certificate or public key',
      'Encrypting cookies',
      'Replacing CA trust stores',
    ],
    answer: 1,
    explain: 'Pinning restricts trusted certificates to specific ones to reduce MITM risk.',
  },
  {
    id: 'q-hard-17',
    difficulty: 'hard',
    prompt: 'Why are long-lived bearer tokens risky in web applications?',
    choices: [
      'They speed up requests',
      'If stolen, they can be reused without further checks for a long period',
      'They cannot be logged',
      'They break CSRF tokens',
    ],
    answer: 1,
    explain: 'Bearer tokens act like keys; long-lived tokens expand the window in which theft is damaging.',
  },
  {
    id: 'q-hard-18',
    difficulty: 'hard',
    prompt: 'Which statement about salting passwords is correct?',
    choices: [
      'The same salt is reused for all users',
      'Unique salts per password defeat precomputed rainbow tables',
      'Salts must be secret',
      'Salts replace hashing',
    ],
    answer: 1,
    explain: 'Unique, non-secret salts ensure each hash is unique even for identical passwords.',
  },
  {
    id: 'q-hard-19',
    difficulty: 'hard',
    prompt: 'Which logging practice most improves forensic usefulness while minimizing risk?',
    choices: [
      'Logging full credit card numbers',
      'Structured logs with minimal sensitive data and secure storage',
      'No logging at all',
      'Logging plaintext passwords for debugging',
    ],
    answer: 1,
    explain: 'Structured logs with careful redaction help investigations without leaking secrets.',
  },
  {
    id: 'q-hard-20',
    difficulty: 'hard',
    prompt: 'Which side-channel attack abuses differences in response time to infer secrets?',
    choices: ['Timing attack', 'Phishing', 'MITM', 'Brute force only'],
    answer: 0,
    explain: 'Timing attacks measure execution time variations to learn about secret values.',
  },
  {
    id: 'q-hard-21',
    difficulty: 'hard',
    prompt: 'What is the main benefit of using Argon2 over a fast hash like SHA-256 for passwords?',
    choices: [
      'Lower CPU usage',
      'Memory-hard design to slow down GPU/ASIC cracking',
      'Shorter hashes',
      'Built-in encryption',
    ],
    answer: 1,
    explain: 'Argon2 is memory-hard, making large-scale brute-force attacks more expensive.',
  },
  {
    id: 'q-hard-22',
    difficulty: 'hard',
    prompt: 'Why is it important to validate JWT “aud” (audience) and “iss” (issuer) claims?',
    choices: [
      'To compress the token',
      'To ensure the token was issued for your application by a trusted authority',
      'To speed up decoding',
      'To enable CORS',
    ],
    answer: 1,
    explain: 'Validating issuer and audience prevents token reuse across unintended services.',
  },
  {
    id: 'q-hard-23',
    difficulty: 'hard',
    prompt: 'What is a practical reason to deploy web application firewalls (WAFs)?',
    choices: [
      'Replace secure coding',
      'Provide an additional layer to detect and block common web exploits',
      'Speed up caching',
      'Encrypt disks',
    ],
    answer: 1,
    explain: 'WAFs add a layer of defense but do not replace secure development practices.',
  },
  {
    id: 'q-hard-24',
    difficulty: 'hard',
    prompt: 'Which scenario best demonstrates lateral movement within a network?',
    choices: [
      'Attacker scans external IPs',
      'Attacker compromises one host, then uses it to access more internal systems',
      'Attacker sends phishing emails',
      'User updates antivirus',
    ],
    answer: 1,
    explain: 'Lateral movement is expansion of access from one compromised system to others.',
  },
  {
    id: 'q-hard-25',
    difficulty: 'hard',
    prompt: 'Why is principle of “zero trust” increasingly adopted in modern architectures?',
    choices: [
      'Internal networks are always safe',
      'It assumes no implicit trust and continuously verifies users and devices',
      'It disables encryption',
      'It relies solely on perimeter firewalls',
    ],
    answer: 1,
    explain: 'Zero trust treats every network segment as untrusted and requires continuous verification.',
  },
];

// Shuffle all choices to randomize answer positions
// Then normalize lengths to prevent prediction based on text size
export const QUIZ_QUESTIONS = normalizeQuizChoices(processQuizQuestions(QUIZ_QUESTIONS_BASE));
